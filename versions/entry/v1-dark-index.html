<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>몽글벨 - 정령과 함께하는 모험</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/variables.css">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/isometric.css">
  <link rel="stylesheet" href="css/scenes/main-menu.css">
  <link rel="stylesheet" href="css/scenes/stage1-candy.css">
  <link rel="stylesheet" href="css/scenes/summoning-room.css">
  <link rel="stylesheet" href="css/scenes/stage2-combat.css">
  <link rel="stylesheet" href="css/scenes/common-pages.css">

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#6b21a8">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="몽글벨">

  <!-- Favicon & Touch Icons -->
  <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="48x48" href="icons/icon-48x48.png">
  <link rel="apple-touch-icon" href="icons/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="167x167" href="icons/icon-167x167.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-180x180.png">
</head>
<body>
  <div id="app"></div>

  <!-- Error display for debugging -->
  <script>
    window.onerror = function(msg, src, line, col, err) {
      var d = document.createElement('pre');
      d.style.cssText = 'position:fixed;top:0;left:0;right:0;background:red;color:white;padding:16px;z-index:9999;font-size:14px;white-space:pre-wrap;';
      d.textContent = 'ERROR: ' + msg + '\nFile: ' + src + ':' + line + ':' + col + '\n' + (err && err.stack ? err.stack : '');
      document.body.appendChild(d);
    };
    window.addEventListener('unhandledrejection', function(e) {
      var d = document.createElement('pre');
      d.style.cssText = 'position:fixed;top:0;left:0;right:0;background:red;color:white;padding:16px;z-index:9999;font-size:14px;white-space:pre-wrap;';
      d.textContent = 'PROMISE ERROR: ' + (e.reason && e.reason.stack ? e.reason.stack : e.reason);
      document.body.appendChild(d);
    });
  </script>

  <!-- Formula Pack (밸런스 공식 시스템) -->
  <script src="js/ai/formula-pack-1.js"></script>
  <script src="js/ai/formula-pack-2.js"></script>
  <script src="js/ai/formula-pack-3.js"></script>
  <script src="js/ai/formula-pack-4.js"></script>
  <script src="js/ai/formula-pack-5.js"></script>
  <script src="js/ai/formula-debug.js"></script>

  <!-- Balance AI + 3D Character Generator -->
  <script src="js/data/balance-ai.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script src="js/render/character-engine-v2.js"></script>
  <script src="js/render/pro-model-gen.js"></script>

  <!-- Art Engine (셰이더 + 환경 + UI 미술) -->
  <script src="js/art/art-core.js"></script>
  <script src="js/art/art-environment.js"></script>
  <script src="js/art/art-ui.js"></script>

  <!-- Text Engine (다국어 텍스트 렌더링) -->
  <script src="js/text/text-core.js"></script>
  <script src="js/text/text-renderer.js"></script>
  <script src="js/text/text-i18n.js"></script>

  <!-- Sound Engine (Web Audio API 합성) -->
  <script src="js/sound/sound-core.js"></script>
  <script src="js/sound/sound-sfx.js"></script>
  <script src="js/sound/sound-bgm.js"></script>

  <!-- Hero AI System (파티 관리 + 전투 AI + 스킬 연출) -->
  <script src="js/ai/hero-ai-core.js"></script>
  <script src="js/ai/hero-ai-battle.js"></script>
  <script src="js/ai/hero-ai-visual.js"></script>

  <!-- Speed AI (100유닛 동시 추격/차단/포위 AI) -->
  <script src="js/ai/speed-ai.js"></script>

  <!-- Formation AI (파티 배치 AI) -->
  <script src="js/ai/formation-ai.js"></script>

  <!-- Survivor Balance AI (뱀서류 밸런스 자동 조절) -->
  <script src="js/ai/survivor-balance.js"></script>

  <!-- Master Director AI (중앙 두뇌 — 모든 생성기 감시/명령) -->
  <script src="js/ai/master-director.js"></script>

  <!-- 웹엔진 Core (글로벌 시스템) -->
  <script src="js/core/scene-engine.js"></script>
  <script src="js/core/save-system.js"></script>
  <script src="js/core/input-manager.js"></script>
  <script src="js/core/camera-controller.js"></script>
  <script src="js/core/responsive.js"></script>
  <script src="js/core/timer-system.js"></script>
  <script src="js/core/dialogue-system.js"></script>
  <script src="js/core/tween-engine.js"></script>

  <!-- 가챠 시스템 (피티→풀→코어→배너→UI 순서) -->
  <script src="js/gacha/pity-system.js"></script>
  <script src="js/gacha/reward-pool.js"></script>
  <script src="js/gacha/gacha-system.js"></script>
  <script src="js/gacha/event-banner.js"></script>
  <script src="js/gacha/gacha-ui.js"></script>

  <!-- Viewport Helper (게임 컨테이너 크기) -->
  <script>
    (function() {
      var _app = function() { return document.getElementById('app'); };
      Object.defineProperty(window, 'APP_W', { get: function() { return _app().clientWidth; } });
      Object.defineProperty(window, 'APP_H', { get: function() { return _app().clientHeight; } });
      Object.defineProperty(window, 'APP_LEFT', { get: function() { return _app().getBoundingClientRect().left; } });
      Object.defineProperty(window, 'APP_TOP', { get: function() { return _app().getBoundingClientRect().top; } });
    })();
  </script>

  <!-- JS Entry Point -->
  <script type="module" src="js/main.js"></script>
</body>
</html>
